# 多点小程序架构方案提议

## 概览

[原生小程序npm支持](https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html)

## 优劣势分析

优势：

1. 集中化管理，维护代码不会随着项目的增多而增多，只需要对npm包进行管理和维护。
2. 项目分层清晰，js逻辑、ui库拆分单一性更高，抽象逻辑更明确，可维护性提高。
3. 新项目创建和开发效率提高。
4. 为未来实现小程序脚手架做积淀，通过QA的方式拉取小程序模版进行小程序快速开发。

劣势：

1. 包管理相对繁琐，比正常开发会多一个管理成本，如文档的维护。
2. 如果需要调试包里的内容需在node_modules中查看和调试，增加一定调试成本。
3. 增加团队学习成本，需要学习npm包发布拉取等相关知识。

### 内部npm库推进的意义

### 目前采用的mpx框架分析

优点：

1. 兼容原生，新语法较少，完全兼容原生写法，迁移代价小
2. 类vue语法，减轻团队成员上手压力，可以轻易的使用自定义组件的relations解决组件间关系
3. 按需引用，对第三方组件库支持良好，打包过程中会进行依赖分析，只打包wxml中使用到的组件和js代码
4. 跨平台，可编译成其他平台小程序，需做部分兼容
5. 能力增强，支持computed、watch、mixins等优秀语法，不限于双向绑定、setData优化、ES6+、预处理支持、分包资源优化等特性增强
6. 性能提升

缺点：

1. 写小程序的基础上多了一层，报错不一定准确，增加一定锁定bug的时间
2. 多了编译的过程，可能增加代码包大小
3. 新手上手会带来一定的学习成本

实际情况：

1. 通过小程序audits面板发现，部分页面使用mpx文件迁移后性能提升10%-20%，如果进行全部页面的迁移可能会带来更大的性能提升。
2. 代码包压缩打包后由1.7M降低到1.35M。
3. 团队成员陈思言迁移会员模块的代价大大降低。
4. 采用分包和分包预编译后进入首页时间降低。

## 规划构想

采用多端方案，一套代码至少可以编译成h5和微信小程序，且保留可编译成其他平台小程序的功能，可以大大提高生产力。
